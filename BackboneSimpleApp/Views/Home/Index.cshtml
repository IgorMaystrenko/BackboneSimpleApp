<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title></title>
</head>
<body>
<div id="app">
    <div id="contact-list">
    </div>
</div>

    <script src="~/Scripts/json2.js"></script>
    <script src="~/Scripts/jquery-1.7.1.js"></script>
    <script src="~/Scripts/underscore.js"></script>
    <script src="~/Scripts/backbone.js"></script>
<script type="text/javascript">

    $(function() {

        var Contact = Backbone.Model.extend({
            initialize: function() {
			},
            clear: function () {
                this.destroy();
            }
        });

        var ContactList = Backbone.Collection.extend({
            model: Contact,
            url: function () {
                return '../api/contacts';
            }
        });

        var contactList = new ContactList();

        var ContactItemView = Backbone.View.extend({
            template: _.template($('#item-template').html()),
            render: function() {
                this.$el.html(this.template(this.model.toJSON()));
                return this;
            }
        });

        var AppView = Backbone.View.extend({
            el: '#app',
            initialize: function () {
                contactList.on('add', this.addOne, this);
                contactList.on('reset', this.addAll, this);
                contactList.fetch(); // Loads list from local storage
            },
            addOne: function (contact) {
                var view = new ContactItemView({ model: contact });
                $('#contact-list').append(view.render().el);
            },
            addAll: function () {
                this.$('#contact-list').html(''); // clean the todo list
                contactList.each(this.addOne, this);
            },
            render: function () {
                $("#contact-list").html("");
                if (this.model.length) {
                    for (var i = 0; i < this.model.length; i++) {
                        var view = new ContactItemView({ model: this.model.at(i) });
                        $("#contact-list").append(view.render().el);
                    }
                }
            }
        });

        var appView = new AppView();

    });

</script>

<script type="text/template" id="item-template">
    <div class="view">
        <label><%- Id %> | </label>
        <label><%- Name %> | </label>
        <label><%- Phone %></label>
    </div>
</script>
</body>
</html>
